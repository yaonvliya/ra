"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(exports,"__esModule",{value:!0});var _map=require("ol/map"),_map2=_interopRequireDefault(_map),_view=require("ol/view"),_view2=_interopRequireDefault(_view),_proj=require("proj4"),_proj2=_interopRequireDefault(_proj),_proj3=require("ol/proj"),_proj4=_interopRequireDefault(_proj3),_geojson=require("ol/format/geojson"),_geojson2=_interopRequireDefault(_geojson),_attribution=require("ol/control/attribution"),_attribution2=_interopRequireDefault(_attribution),_fullscreen=require("ol/control/fullscreen"),_fullscreen2=_interopRequireDefault(_fullscreen),_mouseposition=require("ol/control/mouseposition"),_mouseposition2=_interopRequireDefault(_mouseposition),_overviewmap=require("ol/control/overviewmap"),_overviewmap2=_interopRequireDefault(_overviewmap),_rotate=require("ol/control/rotate"),_rotate2=_interopRequireDefault(_rotate),_scaleline=require("ol/control/scaleline"),_scaleline2=_interopRequireDefault(_scaleline),_zoom=require("ol/control/zoom"),_zoom2=_interopRequireDefault(_zoom),_zoomslider=require("ol/control/zoomslider"),_zoomslider2=_interopRequireDefault(_zoomslider),_zoomtoextent=require("ol/control/zoomtoextent"),_zoomtoextent2=_interopRequireDefault(_zoomtoextent),_BaseTileLy=require("./BaseTileLy"),_BaseTileLy2=_interopRequireDefault(_BaseTileLy),TJMap=function(e){this._init(e)};TJMap.prototype={_init:function(e){this.target=e.target?e.target:"map",this.controlNames=e.controlNames?e.controlNames:[],this.center=e.center?e.center:[0,0],this.zoom=e.zoom?e.zoom:10,this.maxZoom=e.maxZoom?e.maxZoom:18,this.minZoom=e.minZoom?e.minZoom:3,this.mapType=e.mapType?e.mapType:"gd",this.lyTyles=e.lyTyles?e.lyTyles:[],this.map=null,this.baseLys={},this.url=e.url,this.lyName=e.lyName,_proj4.default.setProj4(_proj2.default),_proj2.default.defs("BD-09","+proj=merc +a=6378206 +b=6356584.314245179 +lat_ts=0.0 +lon_0=0.0 +x_0=0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +wktext  +no_defs"),this._loadMap()},_loadMap:function(){this.map=new _map2.default({target:this.target,controls:this._loadControls(),loadTilesWhileAnimating:!1,view:new _view2.default({center:this.xyfromLonLat(this.center),zoom:this.zoom,maxZoom:this.maxZoom,minZoom:this.minZoom,projection:this.getProjection()})}),this.addBaseLy()},_loadControls:function(){var e=[];return this.controlNames.forEach(function(t){switch(t){case"Attribution":e.push(new _attribution2.default);break;case"FullScreen":e.push(new _fullscreen2.default);break;case"MousePosition":e.push(new _mouseposition2.default);break;case"OverviewMap":e.push(new _overviewmap2.default);break;case"Rotate":e.push(new _rotate2.default);break;case"ScaleLine":e.push(new _scaleline2.default);break;case"Zoom":e.push(new _zoom2.default);break;case"Zoomslider":e.push(new _zoomslider2.default);break;case"ZoomToExtent":e.push(new _zoomtoextent2.default)}}),e},clearAllControls:function(){for(var e=this.map.getControls().getArray(),t=0;t<e.length;t++)this.map.removeControl(e[t])},getProjection:function(){switch(this.mapType){case"bd":return _proj4.default.get("BD-09");case"gd":case"tdt":default:return _proj4.default.get("EPSG:3857")}},xyfromLonLat:function(e){switch(this.mapType){case"bd":return _proj4.default.transform(e,"EPSG:4326","BD-09");case"gd":case"tdt":default:return _proj4.default.fromLonLat(e)}},xytoLonLat:function(e){switch(this.mapType){case"bd":return _proj4.default.transform(e,"BD-09","EPSG:4326");case"gd":case"tdt":default:return _proj4.default.toLonLat(e)}},destroy:function(){var e=this;this.map&&(this.map.getLayers().getArray().forEach(function(t){e.map.removeLayer(t)}),this.map.getOverlays().forEach(function(t){e.map.removeOverlay(t)}),this.map.getControls().forEach(function(t){e.map.removeControl(t)}),this.map.getInteractions().forEach(function(t){e.map.removeInteraction(t)}),this.map.setTarget(null)),this.map=null},jsonToFeature:function(e,t,a){return(new _geojson2.default).readFeature(e,{dataProjection:"EPSG:"+t,featureProjection:"EPSG:"+a})},jsonToFeatures:function(e,t,a){return(new _geojson2.default).readFeatures(e,{dataProjection:"EPSG:"+t,featureProjection:"EPSG:"+a})},jsonToGeometry:function(e,t,a){return(new _geojson2.default).readGeometry(e,{dataProjection:"EPSG:"+t,featureProjection:"EPSG:"+a})},featureToJsonStr:function(e,t,a){return(new _geojson2.default).writeFeature(e,{dataProjection:"EPSG:"+a,featureProjection:"EPSG:"+t})},featureToJsonObj:function(e,t,a){return(new _geojson2.default).writeFeatureObject(e,{dataProjection:"EPSG:"+a,featureProjection:"EPSG:"+t})},featuresToJsonStr:function(e,t,a){return(new _geojson2.default).writeFeatures(e,{dataProjection:"EPSG:"+a,featureProjection:"EPSG:"+t})},featuresToJsonObj:function(e,t,a){return(new _geojson2.default).writeFeaturesObject(e,{dataProjection:"EPSG:"+a,featureProjection:"EPSG:"+t})},geometryToJsonStr:function(e,t,a){return(new _geojson2.default).writeGeometry(e,{dataProjection:"EPSG:"+a,featureProjection:"EPSG:"+t})},geometryToJsonObj:function(e,t,a){return(new _geojson2.default).writeGeometryObject(e,{dataProjection:"EPSG:"+a,featureProjection:"EPSG:"+t})},addBaseLy:function(){var e=new _BaseTileLy2.default;if(null===this.lyTyles||void 0===this.lyTyles||0===this.lyTyles.length)switch(this.mapType){case"gd":this.lyTyles=["gd_vec"];break;case"bd":this.lyTyles=["bd_vec"];break;case"tdt":this.lyTyles=["tdt_vec","tdt_veca"]}for(var t=null,a=0,o=this.lyTyles.length;a<o;a++)switch(this.lyTyles[a]){case"gd_vec":t=e.getGdVecLy(),this.map.addLayer(t),this.baseLys.gd_vec=t;break;case"gd_img":t=e.getGdImgLy(),this.map.addLayer(t),this.baseLys.gd_img=t;break;case"gd_imga":t=e.getGdImgALy(),this.map.addLayer(t),this.baseLys.gd_imga=t;break;case"gd_tra":t=e.getGdTrafficLy(),this.map.addLayer(t),this.baseLys.gd_tra=t;break;case"bd_vec":case"bd_vec_0":case"bd_vec_1":case"bd_vec_2":case"bd_vec_3":case"bd_vec_4":case"bd_vec_5":case"bd_vec_6":case"bd_vec_7":case"bd_vec_8":case"bd_vec_9":case"bd_vec_10":case"bd_vec_11":var r=this.lyTyles[a].split("_");t=e.getBdVecLy(r[2]),this.map.addLayer(t),this.baseLys.bd_vec=t;break;case"bd_img":t=e.getBdImgLy(),this.map.addLayer(t),this.baseLys.bd_img=t;break;case"bd_imga":t=e.getBdImgALy(),this.map.addLayer(t),this.baseLys.bd_imga=t;break;case"bd_tra":t=e.getBdTrafficLy(),this.map.addLayer(t),this.baseLys.bd_tra=t;break;case"qq_vec":t=e.getQQVecLy(),this.map.addLayer(t),this.baseLys.qq_vec=t;break;case"qq_tra":t=e.getQQTrafficLy(),this.map.addLayer(t),this.baseLys.qq_tra=t;break;case"tdt_vec":t=e.getTDTVecLy(),this.map.addLayer(t),this.baseLys.tdt_vec=t;break;case"tdt_veca":t=e.getTDTVecALy(),this.map.addLayer(t),this.baseLys.tdt_veca=t;break;case"tdt_img":t=e.getTDTImgLy(),this.map.addLayer(t),this.baseLys.tdt_img=t;break;case"tdt_imga":t=e.getTDTImgALy(),this.map.addLayer(t),this.baseLys.tdt_imga=t;break;case"sz_vec":t=e.getSuZhouLy(this.url,this.lyName),this.map.addLayer(t),this.baseLys.sz_vec=t}}},exports.default=TJMap;